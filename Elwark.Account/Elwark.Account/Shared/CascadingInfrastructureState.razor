@using Elwark.Account.Service.Profile
@using Elwark.Account.Service
@using Elwark.Account.Service.Profile.Models
@inject IInfrastructureClient Client

<CascadingValue Value="_state">
    @ChildContent
</CascadingValue>

@code {

    [Parameter]
    public RenderFragment ChildContent { get; set; } = default!;

    private InfrastructureState _state = new(new Dictionary<string, string>(), new Dictionary<string, string>());

    protected override async Task OnInitializedAsync()
    {
        var result = await Client.GetAsync();
        if (result.Status == ResponseStatus.Success)
        {
            _state = new InfrastructureState(
                result.Data.Countries.ToDictionary(x => x.Code, x => x.Name),
                result.Data.Timezones.ToDictionary(x => x.Name, x => $"{x.Name} ({x.Offset})")
                );
        }
    }

}